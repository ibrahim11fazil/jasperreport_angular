"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
var core_1 = require("@angular/core");
var vg_fullscreen_api_1 = require("./vg-fullscreen-api");
var vg_utils_1 = require("./vg-utils");
describe('Videogular Player', function () {
    var medias;
    var elem;
    var fsAPI;
    beforeEach(function () {
        medias = new core_1.QueryList();
        elem = document.createElement('video');
        fsAPI = new vg_fullscreen_api_1.VgFullscreenAPI();
        fsAPI.isAvailable = true;
        fsAPI.nativeFullscreen = true;
        fsAPI.init(elem, medias);
    });
    it('Should create polyfills on init', function () {
        expect(fsAPI.polyfill.enabled).toBe('fullscreenEnabled');
        expect(fsAPI.polyfill.element).toBe('fullscreenElement');
        expect(fsAPI.polyfill.request).toBe('requestFullscreen');
        expect(fsAPI.polyfill.exit).toBe('exitFullscreen');
        expect(fsAPI.polyfill.onchange).toBe('fullscreenchange');
        expect(fsAPI.polyfill.onerror).toBe('fullscreenerror');
    });
    it('Should request an element to enter in fullscreen mode (desktop)', function () {
        spyOn(fsAPI, 'enterElementInFullScreen').and.callFake(function () { });
        fsAPI.request(null);
        expect(fsAPI.isFullscreen).toBeTruthy();
        expect(fsAPI.enterElementInFullScreen).toHaveBeenCalledWith(elem);
    });
    it('Should request an element to enter in fullscreen mode (mobile)', function () {
        spyOn(vg_utils_1.VgUtils, 'isMobileDevice').and.callFake(function () { return true; });
        spyOn(fsAPI, 'enterElementInFullScreen').and.callFake(function () { });
        fsAPI.request(null);
        expect(fsAPI.isFullscreen).toBeTruthy();
        expect(vg_utils_1.VgUtils.isMobileDevice).toHaveBeenCalled();
        expect(fsAPI.enterElementInFullScreen).toHaveBeenCalledWith(elem);
    });
    it('Should request an element to enter in fullscreen mode (mobile with param elem)', function () {
        spyOn(vg_utils_1.VgUtils, 'isMobileDevice').and.callFake(function () { return true; });
        spyOn(fsAPI, 'enterElementInFullScreen').and.callFake(function () { });
        fsAPI.request(elem);
        expect(fsAPI.isFullscreen).toBeTruthy();
        expect(vg_utils_1.VgUtils.isMobileDevice).toHaveBeenCalled();
        expect(fsAPI.enterElementInFullScreen).toHaveBeenCalledWith(elem);
    });
    it('Should not request an element to enter in fullscreen mode', function () {
        spyOn(fsAPI, 'enterElementInFullScreen').and.callFake(function () { });
        fsAPI.nativeFullscreen = false;
        fsAPI.request(elem);
        expect(fsAPI.enterElementInFullScreen).not.toHaveBeenCalled();
    });
    it('Should enter in fullscreen mode', function () {
        spyOn(elem, 'requestFullscreen').and.callThrough();
        fsAPI.enterElementInFullScreen(elem);
        expect(elem.requestFullscreen).toHaveBeenCalled();
    });
    it('Should request an element to exit from fullscreen mode (native)', function () {
        fsAPI.polyfill.exit = 'mockedExitFunction';
        document.mockedExitFunction = function () { };
        spyOn(document, 'mockedExitFunction').and.callThrough();
        fsAPI.exit();
        expect(fsAPI.isFullscreen).toBeFalsy();
        expect(document.mockedExitFunction).toHaveBeenCalled();
    });
    it('Should request an element to exit from fullscreen mode (emulated)', function () {
        fsAPI.polyfill.exit = 'mockedExitFunction';
        document.mockedExitFunction = function () { };
        spyOn(document, 'mockedExitFunction').and.callThrough();
        fsAPI.nativeFullscreen = false;
        fsAPI.exit();
        expect(fsAPI.isFullscreen).toBeFalsy();
        expect(document.mockedExitFunction).not.toHaveBeenCalled();
    });
    it('Should enter videogular element to fullscreen mode', function () {
        fsAPI.videogularElement = { id: 'vgElem' };
        spyOn(fsAPI, 'request').and.callFake(function () { });
        fsAPI.toggleFullscreen();
        expect(fsAPI.request).toHaveBeenCalledWith(null);
    });
    it('Should enter other element to fullscreen mode', function () {
        var element = { id: 'main' };
        fsAPI.videogularElement = { id: 'vgElem' };
        spyOn(fsAPI, 'request').and.callFake(function () { });
        fsAPI.toggleFullscreen(element);
        expect(fsAPI.request).toHaveBeenCalledWith(element);
    });
    it('Should exit from fullscreen mode', function () {
        fsAPI.isFullscreen = true;
        spyOn(fsAPI, 'exit').and.callFake(function () { });
        fsAPI.toggleFullscreen();
        expect(fsAPI.exit).toHaveBeenCalled();
    });
});

//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoidmctZnVsbHNjcmVlbi1hcGkuc3BlYy5qcyIsInNvdXJjZVJvb3QiOiIiLCJzb3VyY2VzIjpbInZnLWZ1bGxzY3JlZW4tYXBpLnNwZWMudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6Ijs7QUFBQSxzQ0FBd0M7QUFDeEMseURBQW9EO0FBRXBELHVDQUFtQztBQUVuQyxRQUFRLENBQUMsbUJBQW1CLEVBQUU7SUFDMUIsSUFBSSxNQUFxQixDQUFDO0lBQzFCLElBQUksSUFBZ0IsQ0FBQztJQUNyQixJQUFJLEtBQXNCLENBQUM7SUFFM0IsVUFBVSxDQUFDO1FBQ1AsTUFBTSxHQUFHLElBQUksZ0JBQVMsRUFBRSxDQUFDO1FBQ3pCLElBQUksR0FBRyxRQUFRLENBQUMsYUFBYSxDQUFDLE9BQU8sQ0FBQyxDQUFDO1FBRXZDLEtBQUssR0FBRyxJQUFJLG1DQUFlLEVBQUUsQ0FBQztRQUM5QixLQUFLLENBQUMsV0FBVyxHQUFHLElBQUksQ0FBQztRQUN6QixLQUFLLENBQUMsZ0JBQWdCLEdBQUcsSUFBSSxDQUFDO1FBQzlCLEtBQUssQ0FBQyxJQUFJLENBQUMsSUFBSSxFQUFFLE1BQU0sQ0FBQyxDQUFDO0lBQzdCLENBQUMsQ0FBQyxDQUFDO0lBRUgsRUFBRSxDQUFDLGlDQUFpQyxFQUFFO1FBQ2xDLE1BQU0sQ0FBQyxLQUFLLENBQUMsUUFBUSxDQUFDLE9BQU8sQ0FBQyxDQUFDLElBQUksQ0FBQyxtQkFBbUIsQ0FBQyxDQUFDO1FBQ3pELE1BQU0sQ0FBQyxLQUFLLENBQUMsUUFBUSxDQUFDLE9BQU8sQ0FBQyxDQUFDLElBQUksQ0FBQyxtQkFBbUIsQ0FBQyxDQUFDO1FBQ3pELE1BQU0sQ0FBQyxLQUFLLENBQUMsUUFBUSxDQUFDLE9BQU8sQ0FBQyxDQUFDLElBQUksQ0FBQyxtQkFBbUIsQ0FBQyxDQUFDO1FBQ3pELE1BQU0sQ0FBQyxLQUFLLENBQUMsUUFBUSxDQUFDLElBQUksQ0FBQyxDQUFDLElBQUksQ0FBQyxnQkFBZ0IsQ0FBQyxDQUFDO1FBQ25ELE1BQU0sQ0FB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ZnJvbSBcIkBhbmd1bGFyL2NvcmVcIjtcbmltcG9ydCB7VmdGdWxsc2NyZWVuQVBJfSBmcm9tIFwiLi92Zy1mdWxsc2NyZWVuLWFwaVwiO1xuaW1wb3J0IHtWZ01lZGlhfSBmcm9tIFwiLi4vdmctbWVkaWEvdmctbWVkaWFcIjtcbmltcG9ydCB7VmdVdGlsc30gZnJvbSBcIi4vdmctdXRpbHNcIjtcblxuZGVzY3JpYmUoJ1ZpZGVvZ3VsYXIgUGxheWVyJywgKCkgPT4ge1xuICAgIGxldCBtZWRpYXM6UXVlcnlMaXN0PGFueT47XG4gICAgbGV0IGVsZW06SFRNTEVsZW1lbnQ7XG4gICAgbGV0IGZzQVBJOiBWZ0Z1bGxzY3JlZW5BUEk7XG5cbiAgICBiZWZvcmVFYWNoKCgpID0+IHtcbiAgICAgICAgbWVkaWFzID0gbmV3IFF1ZXJ5TGlzdCgpO1xuICAgICAgICBlbGVtID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgndmlkZW8nKTtcblxuICAgICAgICBmc0FQSSA9IG5ldyBWZ0Z1bGxzY3JlZW5BUEkoKTtcbiAgICAgICAgZnNBUEkuaXNBdmFpbGFibGUgPSB0cnVlO1xuICAgICAgICBmc0FQSS5uYXRpdmVGdWxsc2NyZWVuID0gdHJ1ZTtcbiAgICAgICAgZnNBUEkuaW5pdChlbGVtLCBtZWRpYXMpO1xuICAgIH0pO1xuXG4gICAgaXQoJ1Nob3VsZCBjcmVhdGUgcG9seWZpbGxzIG9uIGluaXQnLCAoKSA9PiB7XG4gICAgICAgIGV4cGVjdChmc0FQSS5wb2x5ZmlsbC5lbmFibGVkKS50b0JlKCdmdWxsc2NyZWVuRW5hYmxlZCcpO1xuICAgICAgICBleHBlY3QoZnNBUEkucG9seWZpbGwuZWxlbWVudCkudG9CZSgnZnVsbHNjcmVlbkVsZW1lbnQnKTtcbiAgICAgICAgZXhwZWN0KGZzQVBJLnBvbHlmaWxsLnJlcXVlc3QpLnRvQmUoJ3JlcXVlc3RGdWxsc2NyZWVuJyk7XG4gICAgICAgIGV4cGVjdChmc0FQSS5wb2x5ZmlsbC5leGl0KS50b0JlKCdleGl0RnVsbHNjcmVlbicpO1xuICAgICAgICBleHBlY3QoZnNBUEkucG9seWZpbGwub25jaGFuZ2UpLnRvQmUoJ2Z1bGxzY3JlZW5jaGFuZ2UnKTtcbiAgICAgICAgZXhwZWN0KGZzQVBJLnBvbHlmaWxsLm9uZXJyb3IpLnRvQmUoJ2Z1bGxzY3JlZW5lcnJvcicpO1xuICAgIH0pO1xuXG4gICAgaXQoJ1Nob3VsZCByZXF1ZXN0IGFuIGVsZW1lbnQgdG8gZW50ZXIgaW4gZnVsbHNjcmVlbiBtb2RlIChkZXNrdG9wKScsICgpID0+IHtcbiAgICAgICAgc3B5T24oZnNBUEksICdlbnRlckVsZW1lbnRJbkZ1bGxTY3JlZW4nKS5hbmQuY2FsbEZha2UoKCkgPT4ge30pO1xuXG4gICAgICAgIGZzQVBJLnJlcXVlc3QobnVsbCk7XG5cbiAgICAgICAgZXhwZWN0KGZzQVBJLmlzRnVsbHNjcmVlbikudG9CZVRydXRoeSgpO1xuICAgICAgICBleHBlY3QoZnNBUEkuZW50ZXJFbGVtZW50SW5GdWxsU2NyZWVuKS50b0hhdmVCZWVuQ2FsbGVkV2l0aChlbGVtKTtcbiAgICB9KTtcblxuICAgIGl0KCdTaG91bGQgcmVxdWVzdCBhbiBlbGVtZW50IHRvIGVudGVyIGluIGZ1bGxzY3JlZW4gbW9kZSAobW9iaWxlKScsICgpID0+IHtcbiAgICAgICAgc3B5T24oVmdVdGlscywgJ2lzTW9iaWxlRGV2aWNlJykuYW5kLmNhbGxGYWtlKCgpID0+IHtyZXR1cm4gdHJ1ZTt9KTtcbiAgICAgICAgc3B5T24oZnNBUEksICdlbnRlckVsZW1lbnRJbkZ1bGxTY3JlZW4nKS5hbmQuY2FsbEZha2UoKCkgPT4ge30pO1xuXG4gICAgICAgIGZzQVBJLnJlcXVlc3QobnVsbCk7XG5cbiAgICAgICAgZXhwZWN0KGZzQVBJLmlzRnVsbHNjcmVlbikudG9CZVRydXRoeSgpO1xuICAgICAgICBleHBlY3QoVmdVdGlscy5pc01vYmlsZURldmljZSkudG9IYXZlQmVlbkNhbGxlZCgpO1xuICAgICAgICBleHBlY3QoZnNBUEkuZW50ZXJFbGVtZW50SW5GdWxsU2NyZWVuKS50b0hhdmVCZWVuQ2FsbGVkV2l0aChlbGVtKTtcbiAgICB9KTtcblxuICAgIGl0KCdTaG91bGQgcmVxdWVzdCBhbiBlbGVtZW50IHRvIGVudGVyIGluIGZ1bGxzY3JlZW4gbW9kZSAobW9iaWxlIHdpdGggcGFyYW0gZWxlbSknLCAoKSA9PiB7XG4gICAgICAgIHNweU9uKFZnVXRpbHMsICdpc01vYmlsZURldmljZScpLmFuZC5jYWxsRmFrZSgoKSA9PiB7cmV0dXJuIHRydWU7fSk7XG4gICAgICAgIHNweU9uKGZzQVBJLCAnZW50ZXJFbGVtZW50SW5GdWxsU2NyZWVuJykuYW5kLmNhbGxGYWtlKCgpID0+IHt9KTtcblxuICAgICAgICBmc0FQSS5yZXF1ZXN0KGVsZW0pO1xuXG4gICAgICAgIGV4cGVjdChmc0FQSS5pc0Z1bGxzY3JlZW4pLnRvQmVUcnV0aHkoKTtcbiAgICAgICAgZXhwZWN0KFZnVXRpbHMuaXNNb2JpbGVEZXZpY2UpLnRvSGF2ZUJlZW5DYWxsZWQoKTtcbiAgICAgICAgZXhwZWN0KGZzQVBJLmVudGVyRWxlbWVudEluRnVsbFNjcmVlbikudG9IYXZlQmVlbkNhbGxlZFdpdGgoZWxlbSk7XG4gICAgfSk7XG5cbiAgICBpdCgnU2hvdWxkIG5vdCByZXF1ZXN0IGFuIGVsZW1lbnQgdG8gZW50ZXIgaW4gZnVsbHNjcmVlbiBtb2RlJywgKCkgPT4ge1xuICAgICAgICBzcHlPbihmc0FQSSwgJ2VudGVyRWxlbWVudEluRnVsbFNjcmVlbicpLmFuZC5jYWxsRmFrZSgoKSA9PiB7fSk7XG5cbiAgICAgICAgZnNBUEkubmF0aXZlRnVsbHNjcmVlbiA9IGZhbHNlO1xuICAgICAgICBmc0FQSS5yZXF1ZXN0KGVsZW0pO1xuXG4gICAgICAgIGV4cGVjdChmc0FQSS5lbnRlckVsZW1lbnRJbkZ1bGxTY3JlZW4pLm5vdC50b0hhdmVCZWVuQ2FsbGVkKCk7XG4gICAgfSk7XG5cbiAgICBpdCgnU2hvdWxkIGVudGVyIGluIGZ1bGxzY3JlZW4gbW9kZScsICgpID0+IHtcbiAgICAgICAgc3B5T24oPGFueT5lbGVtLCAncmVxdWVzdEZ1bGxzY3JlZW4nKS5hbmQuY2FsbFRocm91Z2goKTtcblxuICAgICAgICBmc0FQSS5lbnRlckVsZW1lbnRJbkZ1bGxTY3JlZW4oZWxlbSk7XG5cbiAgICAgICAgZXhwZWN0KCg8YW55PmVsZW0pLnJlcXVlc3RGdWxsc2NyZWVuKS50b0hhdmVCZWVuQ2FsbGVkKCk7XG4gICAgfSk7XG5cbiAgICBpdCgnU2hvdWxkIHJlcXVlc3QgYW4gZWxlbWVudCB0byBleGl0IGZyb20gZnVsbHNjcmVlbiBtb2RlIChuYXRpdmUpJywgKCkgPT4ge1xuICAgICAgICBmc0FQSS5wb2x5ZmlsbC5leGl0ID0gJ21vY2tlZEV4aXRGdW5jdGlvbic7XG5cbiAgICAgICAgKDxhbnk+ZG9jdW1lbnQpLm1vY2tlZEV4aXRGdW5jdGlvbiA9ICgpID0+IHt9O1xuXG4gICAgICAgIHNweU9uKGRvY3VtZW50LCAnbW9ja2VkRXhpdEZ1bmN0aW9uJykuYW5kLmNhbGxUaHJvdWdoKCk7XG5cbiAgICAgICAgZnNBUEkuZXhpdCgpO1xuXG4gICAgICAgIGV4cGVjdChmc0FQSS5pc0Z1bGxzY3JlZW4pLnRvQmVGYWxzeSgpO1xuICAgICAgICBleHBlY3QoKDxhbnk+ZG9jdW1lbnQpLm1vY2tlZEV4aXRGdW5jdGlvbikudG9IYXZlQmVlbkNhbGxlZCgpO1xuICAgIH0pO1xuXG4gICAgaXQoJ1Nob3VsZCByZXF1ZXN0IGFuIGVsZW1lbnQgdG8gZXhpdCBmcm9tIGZ1bGxzY3JlZW4gbW9kZSAoZW11bGF0ZWQpJywgKCkgPT4ge1xuICAgICAgICBmc0FQSS5wb2x5ZmlsbC5leGl0ID0gJ21vY2tlZEV4aXRGdW5jdGlvbic7XG5cbiAgICAgICAgKDxhbnk+ZG9jdW1lbnQpLm1vY2tlZEV4aXRGdW5jdGlvbiA9ICgpID0+IHt9O1xuXG4gICAgICAgIHNweU9uKGRvY3VtZW50LCAnbW9ja2VkRXhpdEZ1bmN0aW9uJykuYW5kLmNhbGxUaHJvdWdoKCk7XG5cbiAgICAgICAgZnNBUEkubmF0aXZlRnVsbHNjcmVlbiA9IGZhbHNlO1xuICAgICAgICBmc0FQSS5leGl0KCk7XG5cbiAgICAgICAgZXhwZWN0KGZzQVBJLmlzRnVsbHNjcmVlbikudG9CZUZhbHN5KCk7XG4gICAgICAgIGV4cGVjdCgoPGFueT5kb2N1bWVudCkubW9ja2VkRXhpdEZ1bmN0aW9uKS5ub3QudG9IYXZlQmVlbkNhbGxlZCgpO1xuICAgIH0pO1xuXG4gICAgaXQoJ1Nob3VsZCBlbnRlciB2aWRlb2d1bGFyIGVsZW1lbnQgdG8gZnVsbHNjcmVlbiBtb2RlJywgKCkgPT4ge1xuICAgICAgICBmc0FQSS52aWRlb2d1bGFyRWxlbWVudCA9IDxIVE1MRWxlbWVudD57aWQ6ICd2Z0VsZW0nfTtcblxuICAgICAgICBzcHlPbihmc0FQSSwgJ3JlcXVlc3QnKS5hbmQuY2FsbEZha2UoKCkgPT4ge30pO1xuXG4gICAgICAgIGZzQVBJLnRvZ2dsZUZ1bGxzY3JlZW4oKTtcblxuICAgICAgICBleHBlY3QoZnNBUEkucmVxdWVzdCkudG9IYXZlQmVlbkNhbGxlZFdpdGgobnVsbCk7XG4gICAgfSk7XG5cbiAgICBpdCgnU2hvdWxkIGVudGVyIG90aGVyIGVsZW1lbnQgdG8gZnVsbHNjcmVlbiBtb2RlJywgKCkgPT4ge1xuICAgICAgICBsZXQgZWxlbWVudCA9IHtpZDogJ21haW4nfTtcblxuICAgICAgICBmc0FQSS52aWRlb2d1bGFyRWxlbWVudCA9IDxIVE1MRWxlbWVudD57aWQ6ICd2Z0VsZW0nfTtcblxuICAgICAgICBzcHlPbihmc0FQSSwgJ3JlcXVlc3QnKS5hbmQuY2FsbEZha2UoKCkgPT4ge30pO1xuXG4gICAgICAgIGZzQVBJLnRvZ2dsZUZ1bGxzY3JlZW4oZWxlbWVudCk7XG5cbiAgICAgICAgZXhwZWN0KGZzQVBJLnJlcXVlc3QpLnRvSGF2ZUJlZW5DYWxsZWRXaXRoKGVsZW1lbnQpO1xuICAgIH0pO1xuXG4gICAgaXQoJ1Nob3VsZCBleGl0IGZyb20gZnVsbHNjcmVlbiBtb2RlJywgKCkgPT4ge1xuICAgICAgICBmc0FQSS5pc0Z1bGxzY3JlZW4gPSB0cnVlO1xuXG4gICAgICAgIHNweU9uKGZzQVBJLCAnZXhpdCcpLmFuZC5jYWxsRmFrZSgoKSA9PiB7fSk7XG5cbiAgICAgICAgZnNBUEkudG9nZ2xlRnVsbHNjcmVlbigpO1xuXG4gICAgICAgIGV4cGVjdChmc0FQSS5leGl0KS50b0hhdmVCZWVuQ2FsbGVkKCk7XG4gICAgfSk7XG59KTtcbiJdfQ==